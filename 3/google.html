<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>JR Marqueurs</title>
    <link rel="stylesheet" type="text/css" href="google.css">
</head>
<body>

<h1>MARQUEURS JEAN ROSTAND</h1>
<hr>
<div id="map"></div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA7Y32T_PJHZxYcK3BJYJFNwSl6cuvLXpo&callback=initMap" async defer></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
    var map;
    var markers = [];
    var polylinePath = [];

    function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            center: { lat: 48.9593, lng: 2.5478 }, 
            zoom: 15
        });

        loadDoc();
    }

    function loadDoc() {
        $.ajax({
            url: "markersJrostand.json", 
            method: "GET",
            dataType: "json",
            success: function(data) {
                for (var i = 0; i < data.length; i++) {
                    var markerData = data[i];
                    var latLng = new google.maps.LatLng(markerData.lat, markerData.lng);

                    // Créer un marqueur
                    var googleMarker = new google.maps.Marker({
                        position: latLng,
                        map: map
                    });
                    markers.push(googleMarker);
                    polylinePath.push(latLng);

                    // Ajouter un événement 'click' au marqueur
                    (function(marker, index) {
                        google.maps.event.addListener(marker, 'click', function() {
                            alert("Vous avez cliqué sur le marqueur " + (index + 1) + " à la position : Lat " + marker.getPosition().lat() + ", Lng " + marker.getPosition().lng());
                        });
                    })(googleMarker, i); // Utilisation d'une IIFE pour gérer la fermeture (closure)
                }

                // Tracer la polyligne reliant les marqueurs
                var polyline = new google.maps.Polyline({
                    path: polylinePath,
                    geodesic: true,
                    strokeColor: '#FF0000',
                    strokeOpacity: 1.0,
                    strokeWeight: 2
                });

                polyline.setMap(map);
            },
            error: function(xhr, status, error) {
                console.error("Erreur lors du chargement des données JSON:", error);
            }
        });
    }
</script>

</body>
</html>
